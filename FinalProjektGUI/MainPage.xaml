<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Maui;assembly=LiveChartsCore.SkiaSharpView.Maui"
             x:Class="FinalProjektGUI.MainPage"
             Title="Meadow Serial Monitor">

    <Grid Padding="10" RowSpacing="10" ColumnSpacing="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Mode Selector Panel -->
        <Frame Grid.Row="0" BorderColor="Gray" CornerRadius="5" Padding="10">
            <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">
                <Label Text="View Mode:" VerticalOptions="Center" FontAttributes="Bold"/>
                <RadioButton x:Name="MonitorModeRadio" Content="Monitor" IsChecked="True" CheckedChanged="OnViewModeChanged" GroupName="ViewMode"/>
                <RadioButton x:Name="GraphModeRadio" Content="Graph" CheckedChanged="OnViewModeChanged" GroupName="ViewMode"/>
            </HorizontalStackLayout>
        </Frame>

        <!-- Serial Port Connection Panel -->
        <Frame Grid.Row="1" BorderColor="Gray" CornerRadius="5" Padding="10">
            <Grid ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Text="COM Port:" VerticalOptions="Center"/>
                <Picker Grid.Column="1" x:Name="ComPortPicker" VerticalOptions="Center"/>
                <Button Grid.Column="2" x:Name="ConnectButton" Text="Connect" Clicked="OnConnectClicked" WidthRequest="100"/>
                <Button Grid.Column="3" x:Name="DisconnectButton" Text="Disconnect" Clicked="OnDisconnectClicked" WidthRequest="100" IsEnabled="False"/>
            </Grid>
        </Frame>

        <!-- Monitor View -->
        <Grid x:Name="MonitorView" Grid.Row="2" RowSpacing="10" ColumnSpacing="10" IsVisible="True">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Solar Output Panel -->
        <Frame Grid.Row="0" Grid.Column="0" BorderColor="Gray" CornerRadius="5" Padding="10">
            <Grid RowSpacing="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" Text="Solar Output" FontAttributes="Bold" FontSize="16" HorizontalOptions="Center"/>
                <Label Grid.Row="1" x:Name="SolarOutputLabel" Text="0.000 V" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center"/>
            </Grid>
        </Frame>

        <!-- Battery Status Panel -->
        <Frame Grid.Row="0" Grid.Column="1" BorderColor="Gray" CornerRadius="5" Padding="10">
            <Grid RowSpacing="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" Text="Battery Status" FontAttributes="Bold" FontSize="16" HorizontalOptions="Center"/>
                <Label Grid.Row="1" x:Name="BatteryVoltageLabel" Text="0.000 V" FontSize="18" FontAttributes="Bold" HorizontalOptions="Center"/>
                <ProgressBar Grid.Row="2" x:Name="BatteryBar" Progress="0" ProgressColor="Green" HeightRequest="30" WidthRequest="150" HorizontalOptions="Center"/>
                <Label Grid.Row="3" x:Name="BatteryStatusLabel" Text="--- at 0 mA" FontSize="14" FontAttributes="Bold" HorizontalOptions="Center"/>
            </Grid>
        </Frame>

        <!-- Circuit Status Panel -->
        <Frame Grid.Row="0" Grid.Column="2" BorderColor="Gray" CornerRadius="5" Padding="10">
            <Grid RowSpacing="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" Text="Circuit Status" FontAttributes="Bold" FontSize="16" HorizontalOptions="Center"/>
                <Label Grid.Row="1" x:Name="CircuitStatusLabel" Text="ON" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center" TextColor="Green"/>
                <Button Grid.Row="2" x:Name="ResetButton" Text="Reset Breaker" Clicked="OnResetBreakerClicked" HorizontalOptions="Center" WidthRequest="120"/>
            </Grid>
        </Frame>

        <!-- Parsed Data Display Panel -->
        <Frame Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" BorderColor="Gray" CornerRadius="5" Padding="10">
            <Grid RowSpacing="5" ColumnSpacing="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Row="0" Grid.Column="0" Text="Raw ADC Data" FontAttributes="Bold" FontSize="16" Grid.ColumnSpan="4"/>

                <!-- Packet Number -->
                <Label Grid.Row="1" Grid.Column="0" Text="Packet #:"/>
                <Label Grid.Row="1" Grid.Column="1" x:Name="PacketNumberLabel" Text="---" FontAttributes="Bold"/>

                <!-- ADC Values -->
                <Label Grid.Row="2" Grid.Column="0" Text="ADC0:"/>
                <Label Grid.Row="2" Grid.Column="1" x:Name="Adc0Label" Text="----"/>
                <Label Grid.Row="2" Grid.Column="2" Text="ADC1:"/>
                <Label Grid.Row="2" Grid.Column="3" x:Name="Adc1Label" Text="----"/>

                <Label Grid.Row="3" Grid.Column="0" Text="ADC2:"/>
                <Label Grid.Row="3" Grid.Column="1" x:Name="Adc2Label" Text="----"/>
                <Label Grid.Row="3" Grid.Column="2" Text="ADC3:"/>
                <Label Grid.Row="3" Grid.Column="3" x:Name="Adc3Label" Text="----"/>

                <Label Grid.Row="4" Grid.Column="0" Text="ADC4:"/>
                <Label Grid.Row="4" Grid.Column="1" x:Name="Adc4Label" Text="----"/>
                <Label Grid.Row="4" Grid.Column="2" Text="ADC5:"/>
                <Label Grid.Row="4" Grid.Column="3" x:Name="Adc5Label" Text="----"/>
            </Grid>
        </Frame>

        <!-- Digital Inputs and Checksum -->
        <Grid Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" ColumnSpacing="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Digital Inputs Panel -->
            <Frame Grid.Column="0" BorderColor="Gray" CornerRadius="5" Padding="10">
                <Grid RowSpacing="5" ColumnSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Label Grid.Row="0" Grid.Column="0" Text="Digital Inputs" FontAttributes="Bold" Grid.ColumnSpan="4"/>
                    <Label Grid.Row="1" Grid.Column="0" Text="DI0:"/>
                    <Label Grid.Row="1" Grid.Column="1" x:Name="Di0Label" Text="-"/>
                    <Label Grid.Row="1" Grid.Column="2" Text="DI1:"/>
                    <Label Grid.Row="1" Grid.Column="3" x:Name="Di1Label" Text="-"/>

                    <Label Grid.Row="2" Grid.Column="0" Text="DI2:"/>
                    <Label Grid.Row="2" Grid.Column="1" x:Name="Di2Label" Text="-"/>
                    <Label Grid.Row="2" Grid.Column="2" Text="DI3:"/>
                    <Label Grid.Row="2" Grid.Column="3" x:Name="Di3Label" Text="-"/>
                </Grid>
            </Frame>

            <!-- Checksum Panel -->
            <Frame Grid.Column="1" BorderColor="Gray" CornerRadius="5" Padding="10">
                <Grid RowSpacing="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Label Grid.Row="0" Grid.Column="0" Text="Checksum" FontAttributes="Bold" Grid.ColumnSpan="2"/>
                    <Label Grid.Row="1" Grid.Column="0" Text="Received:"/>
                    <Label Grid.Row="1" Grid.Column="1" x:Name="ReceivedChecksumLabel" Text="---"/>
                    <Label Grid.Row="2" Grid.Column="0" Text="Calculated:"/>
                    <Label Grid.Row="2" Grid.Column="1" x:Name="CalculatedChecksumLabel" Text="---"/>
                </Grid>
            </Frame>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" RowSpacing="10" ColumnSpacing="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- LED Control Panel -->
            <Frame Grid.Row="0" Grid.Column="0" BorderColor="Gray" CornerRadius="5" Padding="10">
                <Grid ColumnSpacing="15" RowSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Label Grid.Row="0" Grid.Column="0" Text="LED Control" FontAttributes="Bold" Grid.ColumnSpan="3" HorizontalOptions="Center" FontSize="16"/>

                    <!-- Mode Selector -->
                    <HorizontalStackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Spacing="10" HorizontalOptions="Center">
                        <Label Text="Manual" VerticalOptions="Center"/>
                        <Switch x:Name="ModeSwitch" Toggled="OnModeChanged" VerticalOptions="Center"/>
                        <Label Text="Traffic" VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <VerticalStackLayout Grid.Row="2" Grid.Column="0" Spacing="5">
                        <Label Text="Yellow LED" HorizontalOptions="Center" TextColor="Orange" FontAttributes="Bold"/>
                        <Switch x:Name="Led2Switch" Toggled="OnLedToggled" HorizontalOptions="Center"/>
                        <Label x:Name="YellowCurrentLabel" Text="0 mA" HorizontalOptions="Center" FontSize="12"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Row="2" Grid.Column="1" Spacing="5">
                        <Label Text="Red LED" HorizontalOptions="Center" TextColor="Red" FontAttributes="Bold"/>
                        <Switch x:Name="Led3Switch" Toggled="OnLedToggled" HorizontalOptions="Center"/>
                        <Label x:Name="RedCurrentLabel" Text="0 mA" HorizontalOptions="Center" FontSize="12"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Row="2" Grid.Column="2" Spacing="5">
                        <Label Text="Green LED" HorizontalOptions="Center" TextColor="Green" FontAttributes="Bold"/>
                        <Switch x:Name="Led4Switch" Toggled="OnLedToggled" HorizontalOptions="Center"/>
                        <Label x:Name="GreenCurrentLabel" Text="0 mA" HorizontalOptions="Center" FontSize="12"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- Total Load Current Panel -->
            <Frame Grid.Row="0" Grid.Column="1" BorderColor="Gray" CornerRadius="5" Padding="10">
                <Grid RowSpacing="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <Label Grid.Row="0" Text="Total Load Current" FontAttributes="Bold" FontSize="16" HorizontalOptions="Center"/>
                    <Label Grid.Row="1" x:Name="TotalLoadCurrentLabel" Text="0 mA" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center"/>
                </Grid>
            </Frame>

            <!-- Scrolling Log -->
            <Frame Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" BorderColor="Gray" CornerRadius="5" Padding="10">
                <Grid RowSpacing="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0" ColumnSpacing="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <Label Grid.Column="0" Text="Raw Data Log" FontAttributes="Bold" VerticalOptions="Center"/>
                        <HorizontalStackLayout Grid.Column="1" Spacing="5">
                            <Label Text="Auto-scroll:" VerticalOptions="Center"/>
                            <Switch x:Name="AutoScrollSwitch" IsToggled="True" VerticalOptions="Center"/>
                        </HorizontalStackLayout>
                        <Button Grid.Column="2" Text="Clear" Clicked="OnClearLogClicked" WidthRequest="80"/>
                    </Grid>
                    
                    <ScrollView Grid.Row="1" x:Name="LogScrollView">
                        <Label x:Name="RawDataLog" FontFamily="Courier New" FontSize="12" LineBreakMode="WordWrap"/>
                    </ScrollView>
                </Grid>
            </Frame>
        </Grid>
        </Grid>
        <!-- End Monitor View -->

        <!-- Graph View -->
        <Grid x:Name="GraphView" Grid.Row="2" RowSpacing="10" IsVisible="False">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Time Window Selector -->
            <Frame Grid.Row="0" BorderColor="Gray" CornerRadius="5" Padding="10">
                <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Time Window:" VerticalOptions="Center" FontAttributes="Bold"/>
                        <Picker x:Name="TimeWindowPicker" SelectedIndexChanged="OnTimeWindowChanged" WidthRequest="150">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>10 seconds</x:String>
                                    <x:String>30 seconds</x:String>
                                    <x:String>1 minute</x:String>
                                    <x:String>2 minutes</x:String>
                                    <x:String>5 minutes</x:String>
                                    <x:String>10 minutes</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>
                    </HorizontalStackLayout>
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Current Scale (mA):" VerticalOptions="Center" FontAttributes="Bold"/>
                        <Picker x:Name="CurrentScalePicker" SelectedIndexChanged="OnCurrentScaleChanged" WidthRequest="100">
                            <Picker.ItemsSource>
                                <x:Array Type="{x:Type x:String}">
                                    <x:String>1</x:String>
                                    <x:String>2</x:String>
                                    <x:String>3</x:String>
                                    <x:String>4</x:String>
                                    <x:String>5</x:String>
                                    <x:String>6</x:String>
                                    <x:String>7</x:String>
                                    <x:String>8</x:String>
                                    <x:String>9</x:String>
                                    <x:String>10</x:String>
                                </x:Array>
                            </Picker.ItemsSource>
                        </Picker>
                    </HorizontalStackLayout>
                </HorizontalStackLayout>
            </Frame>

            <!-- Charts ScrollView -->
            <ScrollView Grid.Row="1">
                <VerticalStackLayout Spacing="15" Padding="10">
                    <!-- Solar Output Chart -->
                    <Frame BorderColor="Gray" CornerRadius="5" Padding="10">
                        <Grid RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="300"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Solar Output Voltage (0-3.5V)" FontAttributes="Bold" FontSize="16"/>
                                <Button Grid.Column="1" Text="Clear" Clicked="OnClearSolarChart" WidthRequest="80"/>
                            </Grid>
                            <lvc:CartesianChart Grid.Row="1" x:Name="SolarChart" BackgroundColor="#1A1A1A"/>
                        </Grid>
                    </Frame>

                    <!-- Battery Voltage Chart -->
                    <Frame BorderColor="Gray" CornerRadius="5" Padding="10">
                        <Grid RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="300"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Battery Voltage (0-3.5V)" FontAttributes="Bold" FontSize="16"/>
                                <Button Grid.Column="1" Text="Clear" Clicked="OnClearBatteryChart" WidthRequest="80"/>
                            </Grid>
                            <lvc:CartesianChart Grid.Row="1" x:Name="BatteryChart" BackgroundColor="#1A1A1A"/>
                        </Grid>
                    </Frame>

                    <!-- Total Load Current Chart -->
                    <Frame BorderColor="Gray" CornerRadius="5" Padding="10">
                        <Grid RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="300"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Total Load Current (mA)" FontAttributes="Bold" FontSize="16"/>
                                <Button Grid.Column="1" Text="Clear" Clicked="OnClearTotalLoadChart" WidthRequest="80"/>
                            </Grid>
                            <lvc:CartesianChart Grid.Row="1" x:Name="TotalLoadChart" BackgroundColor="#1A1A1A"/>
                        </Grid>
                    </Frame>

                    <!-- Yellow LED Current Chart -->
                    <Frame BorderColor="Gray" CornerRadius="5" Padding="10">
                        <Grid RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="300"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Yellow LED Current (mA)" FontAttributes="Bold" FontSize="16"/>
                                <Button Grid.Column="1" Text="Clear" Clicked="OnClearYellowChart" WidthRequest="80"/>
                            </Grid>
                            <lvc:CartesianChart Grid.Row="1" x:Name="YellowChart" BackgroundColor="#1A1A1A"/>
                        </Grid>
                    </Frame>

                    <!-- Red LED Current Chart -->
                    <Frame BorderColor="Gray" CornerRadius="5" Padding="10">
                        <Grid RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="300"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Red LED Current (mA)" FontAttributes="Bold" FontSize="16"/>
                                <Button Grid.Column="1" Text="Clear" Clicked="OnClearRedChart" WidthRequest="80"/>
                            </Grid>
                            <lvc:CartesianChart Grid.Row="1" x:Name="RedChart" BackgroundColor="#1A1A1A"/>
                        </Grid>
                    </Frame>

                    <!-- Green LED Current Chart -->
                    <Frame BorderColor="Gray" CornerRadius="5" Padding="10">
                        <Grid RowSpacing="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="300"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" Text="Green LED Current (mA)" FontAttributes="Bold" FontSize="16"/>
                                <Button Grid.Column="1" Text="Clear" Clicked="OnClearGreenChart" WidthRequest="80"/>
                            </Grid>
                            <lvc:CartesianChart Grid.Row="1" x:Name="GreenChart" BackgroundColor="#1A1A1A"/>
                        </Grid>
                    </Frame>
                </VerticalStackLayout>
            </ScrollView>
        </Grid>
        <!-- End Graph View -->

    </Grid>

</ContentPage>
